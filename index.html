<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Visibility from Meteosource</title>
</head>
<body>
  <h1>Current Visibility</h1>
  <div id="visibility">Loading...</div>

  <script>
    const apiKey = 'mpwturrttqmcb4ax95xo94feri15h24bzcj6736m';
    const lat = '40.7128';   // Replace with your latitude
    const lon = '-74.0060';  // Replace with your longitude

    const url = `https://www.meteosource.com/api/v1/free/point?lat=${lat}&lon=${lon}&sections=current&units=metric&language=en&key=${apiKey}`;

    fetch(url)
      .then(response => {
        if (!response.ok) throw new Error('Network response was not ok');
        return response.json();
      })
      .then(data => {
        // Check the structure of data.current
        if (data.current && data.current.visibility !== undefined) {
          const visibility = data.current.visibility; // in meters
          document.getElementById('visibility').textContent = `Visibility: ${visibility} meters`;
        } else {
          document.getElementById('visibility').textContent = 'Visibility data not found.';
          console.log('API response:', data);
        }
      })
      .catch(error => {
        document.getElementById('visibility').textContent = `Error fetching data: ${error.message}`;
      });
  </script>
</body>
</html>
